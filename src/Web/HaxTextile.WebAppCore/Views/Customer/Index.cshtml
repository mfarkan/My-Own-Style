@{
    Layout = "_AdminLayout";
}
@using Core.Enumarations
@using HaxTextile.WebAppCore.Models.Customer
@model CustomerSearchRequestDTO
<title>Müşteri İşlemleri</title>
<script src="~/jQueryDataTable/jquery.dataTables.min.js"></script>
<div class="container-fluid">
    <div class="col-md-12">
        <div class="row">
            <div class="col-12 grid-margin">
                <div class="card shadow">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Müşteri İşlemleri</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Müşteri Ad:</label>
                                    <div class="col-sm-8">
                                        <input type="text" asp-for="CustomerName" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Müşteri Tip:</label>
                                    <div class="col-sm-8">
                                        @Html.DropDownListFor(q => q.CustomerType, Html.GetEnumSelectList<CustomerType>(), "Seçiniz.", new { @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Müşteri Mail:</label>
                                    <div class="col-sm-8">
                                        <input type="email" asp-for="CustomerEmail" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Müşteri Telefon:</label>
                                    <div class="col-sm-8">
                                        <input type="text" asp-for="CustomerPhoneNumber" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-8">
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-info" id="searchButton"><i class="fa fa-search"></i> Müşteri Ara</button>
                                <button class="btn btn-info" type="button" id="newCustomerButton"><i class="fa fa-plus"></i> Yeni Müşteri</button>
                            </div>
                        </div>
                        <br />
                        <div class="col-md-12">
                            <table id="datatable-ApiList" class="table table-striped table-bordered dt-responsive nowrap tableSC" cellspacing="0" width="100%">
                                <thead>
                                    <tr class="text-center">
                                        <th>Müşteri Adı</th>
                                        <th>Müşteri Telefon</th>
                                        <th>Müşteri Tip</th>
                                        <th>Müşteri Açıklama</th>
                                        <th>Müşteri Mail</th>
                                        <th style="width:80px;">#</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<link href="~/jQueryDataTable/dataTables.bootstrap4.min.css" rel="stylesheet" />
<script src="~/jQueryDataTable/dataTables.bootstrap4.min.js"></script>
@section Scripts
{
    <script>
        function Update(id) {
            window.location = window.location.protocol + "//" + window.location.hostname + ":" + window.location.port + "/Customer/Update?Id=" + id;
        }
        function Delete(id) {
            $.ajax({
                url: 'Customer/DeleteCustomer/' + id,
                type: 'DELETE',
                success: function (result) {
                    console.log(result);
                    swal.fire({
                        type: 'success',
                        title: 'Başarılı',
                        confirmButtonText: 'Kapat',
                        text: 'Silme işlemi başarıyla gerçekleşti.'
                    }).then((result) => {
                        if (result.value) {
                            DataListGrid.draw();
                        }
                    });
                },
                error: function (result) {
                    swal.fire({
                        type: 'error',
                        title: 'Hata',
                        text: 'Silme işlemi sırasında hata gerçekleşti.'
                    });
                }
            });
        }
        var DataListGrid = null;
        function fillDataList() {
            if (DataListGrid != null)
                DataListGrid.destroy();
            var grid = $('#datatable-ApiList').DataTable({
                "destroy": true,
                "processing": true,
                "info": false,
                "serverSide": true,
                "ordering": false,
                "searching": false,
                "ajax": {
                    "url": 'http://localhost:55467/Customer/CustomerList',
                    "dataSrc": 'customers',
                    cache: false,
                    "data": function (data) {
                        data.CustomerName = $('#CustomerName').val();
                        data.CustomerType = $('#CustomerType').val();
                        data.CustomerEmail = $('#CustomerEmail').val();
                        data.CustomerPhoneNumber = $('#CustomerPhoneNumber').val();
                    },
                },
                "columns": [
                    { "data": "customerName" },
                    { "data": "customerTelephoneNumber" },
                    { "data": "customerCompanyType" },
                    { "data": "customerDescription" },
                    { "data": "customerEmailAddress" },
                    { "data": "#" }
                ],
                "language": {
                    "url": "/json/Turkish.json"
                },
                drawCallback: function (settings) {
                    var pagination = $(this).closest('.dataTables_wrapper').find('.dataTables_paginate');
                    pagination.toggle(this.api().page.info().pages > 10);
                },
                "columnDefs": [{
                    "targets": -1,
                    "data": null,
                    "defaultContent":
                        "<button type='button' id='updateButton' class='btn btn-link'><i class='fas fa-pen-alt'></i></button>" +
                        "<button type='button' id='deleteButton' class='btn btn-link'><i class='far fa-trash-alt'></i></button>"
                },
                {
                    targets: [2],
                    render: function (data, type, row) {
                        switch (data) {
                            case 1:
                                return 'Tüzel';
                            case 2:
                                return 'Şahıs';
                            default:
                        }
                    }
                }]
            });
            DataListGrid = grid;
        }
        $(document).ready(function () {
            fillDataList();
            $('#datatable-ApiList').on('click', '#updateButton', function (e) {
                var data = DataListGrid.row($(this).parents('tr')).data();
                Update(data["id"]);
            });
            $('#datatable-ApiList').on('click', '#deleteButton', function (e) {
                var data = DataListGrid.row($(this).parents('tr')).data();
                Delete(data["id"]);
            });
            $('#searchButton').click(function () {
                fillDataList();
            });
            $('#newCustomerButton').click(function () {
                window.location = window.location.protocol + "//" + window.location.hostname + ":" + window.location.port + "/Customer/Create";
            });
        });
    </script>


}

